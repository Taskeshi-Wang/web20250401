<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員/訂單資料</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mycss.css">
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css" />
    <style>
        body {
            font-family: "Kiwi Maru", serif;
            font-weight: 400;
            font-style: normal;
        }

        .dropdown-content {
            position: fixed;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .nav-links a:hover {
            background-color: #f10e65;
            border-radius: 5px;
        }

        .white-black-btn {
            background-color: white;
            color: black;
            border: 0px solid;
            padding: 5px 30px;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .white-black-btn:hover {
            background-color: rgb(80, 3, 80);
            color: white;
        }

        .intro:hover {
            color: rgb(112, 5, 103);
            border: 2px solid;
        }

        .yellow-black-btn {
            background-color: rgb(238, 176, 105);
            color: black;
            border: 0px solid;
            margin: auto;
            width: 150px;
            padding: 5px 20px;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .intro:hover .yellow-black-btn {
            background-color: rgb(80, 3, 80);
            color: white;
        }

        .btn-purple {
            background-color: #240224;
            color: aliceblue;
            font-size: 20px;
        }

        .btn-purple:hover {
            background-color: #f360f3;
        }

        .slide-btn:hover {
            background-color: #e78d06;
        }

        .carousel-item img {
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            height: auto;

        }

        .member_container {
            width: 80%;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
            background: rgba(98, 98, 98, 0.3);
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            color: white;

        }

        .member_container .h2 {
            color: #28a745;
        }

        #profileImg {
            border: 3px solid #28a745;
        }

        .member_container .btn {
            width: 45%;
            margin: 5px;
        }
    </style>



</head>

<body>
    <section id="s01" class="py-1 w-100" style="background-color:#b42a64;position: sticky;top: 0;z-index: 10;">
        <div class="container">
            <div class="text-end">
                <a href="#">
                    <i class="fa-brands fa-square-facebook text-primary"></i>
                </a>
                <a href="#">
                    <i class="fa-brands fa-square-x-twitter text-black"></i>
                </a>
                <a href="#">
                    <i class="fa-brands fa-instagram text-danger"></i>
                </a>
                <a href="#">
                    <i class="fa-brands fa-line text-success"></i>
                </a>
            </div>
        </div>
    </section>
    <section id="s02" class="pt-3 w-100" style="background-color: #faf9f9;position: sticky;top:32px;z-index: 10;">
        <div class="container">
            <nav class="navbar navbar-expand-lg" style="background-color: #faf9f9;">
                <div class="container-fluid">
                    <a class="navbar-brand" href="index.html">
                        <img src="images/company_logo.jpg" alt="" style="width: 120px;height: 50px;">
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto nav-links" style="white-space: nowrap;">
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=歐洲" data-region="歐洲">歐洲</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=大陸" data-region="大陸">大陸</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=紐澳" data-region="紐澳">紐澳</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=美加" data-region="美加">美加</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=中東" data-region="中東">中東</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=日本" data-region="日本">日本</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=韓國" data-region="韓國">韓國</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=東南亞" data-region="東南亞">東南亞</a>
                            </li>
                            <li class="nav-item fw-1000 fs-4">
                                <a class="nav-link" aria-current="page"
                                    href="20241226-ex1-process_list_panel_v1.html?region=遊輪" data-region="遊輪">豪華遊輪</a>
                            </li>
                        </ul>
                        <div class="dropdown mt-1 me-2">
                            <button class="btn btn-outline-danger dropdown-toggle d-none fs-5 fw-900" type="button"
                                id="s02_manager_panel_btn" data-bs-toggle="dropdown" aria-expanded="false">
                                管理者功能
                            </button>
                            <ul class="dropdown-menu dropdown-content" aria-labelledby="s02_manager_panel_btn">
                                <li><a class="dropdown-item" href="20241226-ex1-member_control_panel_v1.html"
                                        >會員管理</a></li>
                                <li><a class="dropdown-item" href="20241226-ex1-orders_control_panel_v1.html"
                                        >訂單管理</a></li>
                                <li><a class="dropdown-item" href="20241226-ex1-process_control_panel_v1.html?region=歐洲"
                                        >行程管理</a></li>
                                <li><a class="dropdown-item" href="20241226-ex1-report_control_panel_v1.html"
                                        >營業報表</a></li>
                                <li><a class="dropdown-item" href="20241226-ex1-member_edit_panel_v1.html#account"
                                        >帳號管理</a></li>
                                <li><a class="dropdown-item" href="20241226-ex1-member_edit_panel_v1.html#order_query"
                                        >訂單查詢</a></li>
                                <li><a class="dropdown-item" href="https://rate.bot.com.tw/xrt?Lang=zh-tw&redirect=true"
                                        target="_blank">匯率查詢</a></li>
                                <li><a class="dropdown-item" href="https://www.trivago.com.tw/" target="_blank">旅館查詢</a>
                                </li>
                            </ul>
                        </div>
                        <div class="dropdown mt-1 me-2">
                            <button class="btn btn-outline-danger dropdown-toggle d-none fs-5 fw-900" type="button"
                                id="s02_member_panel_btn" data-bs-toggle="dropdown" aria-expanded="false">
                                會員功能
                            </button>
                            <ul class="dropdown-menu dropdown-content" aria-labelledby="s02_member_panel_btn">
                                <li><a class="dropdown-item" href="20241226-ex1-member_edit_panel_v1.html#account"
                                        >帳號管理</a></li>
                                <li><a class="dropdown-item" href="20241226-ex1-member_edit_panel_v1.html#order_query"
                                        >訂單查詢</a></li>
                                <li><a class="dropdown-item" href="https://rate.bot.com.tw/xrt?Lang=zh-tw&redirect=true"
                                        target="_blank">匯率查詢</a></li>
                                <li><a class="dropdown-item" href="https://www.trivago.com.tw/" target="_blank">旅館查詢</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <span class="h4 text-success fw-900 me-3 d-none" id="s02_username_showtext"
                            style="white-space: nowrap;">歡迎會員:<span class="h3 text-warning" id="s02_username_text"
                                style="white-space: nowrap;"></span></span>
                    </div>
                    <div>
                        <button class="btn btn-danger d-none" data-bs-toggle="logoutmodal" data-bs-target="#logoutModal"
                            style="white-space: nowrap;" id="s02_logout_btn">登出</button>
                    </div>
                </div>
            </nav>
        </div>
    </section>
    <section id="s03" class="d-flex justify-content-center my-5">
        <div class="member_container">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="account-tab" href="#account" data-bs-toggle="tab"
                        data-bs-target="#account" type="button" role="tab" aria-controls="account"
                        aria-selected="true">帳號管理</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="order_query-tab" href="#order_query" data-bs-toggle="tab"
                        data-bs-target="#order_query" type="button" role="tab" aria-controls="order_query"
                        aria-selected="false">訂單查詢</button>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="account" role="tabpanel" aria-labelledby="account-tab">
                    <h2 class="text-center mb-3">會員資料修改</h2>
                    <form id="updateuser" enctype="multipart/form-data">
                        <div><input type="hidden" id="updateModal_id" name="updateModal_id"></div>
                        <div><input type="hidden" id="updateModal_oldphotopath" name="updateModal_oldphotopath"></div>
                        <div class="row text-center">
                            <div class="col-md-12">
                                <div class="mb-3 text-center">
                                    <img id="profileImg" name="profileImg" src="default-avatar.png"
                                        class="rounded-circle img-fluid" style="width: 148px;" alt="會員頭像">
                                    <input type="file" id="updateModal_uploadPath" name="updateModal_uploadPath"
                                        class="form-control mt-2">
                                    <div class="valid-feedback">上傳格式為jpeg or png or gif or webp</div>
                                    <div class="invalid-feedback">不符合上傳格式</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="" class="form-label">帳號</label>
                                    <input type="text" class="form-control is-valid" id="updateModal_username"
                                        name="updateModal_username">
                                    <div class="valid-feedback" id="updateModal_username-valid-feedback">符合規則</div>
                                    <div class="invalid-feedback" id="updateModal_username-invalid-feedback">不符合規則</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="pwd" class="form-label">新密碼</label>
                                    <input type="password" class="form-control" id="updateModal_pwd"
                                        name="updateModal_pwd" placeholder="包含英數字及特殊符號（留空則不變更）">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="" class="form-label">電話</label>
                                    <input type="text" class="form-control is-valid" id="updateModal_tel"
                                        name="updateModal_tel">
                                    <div class="valid-feedback" id="updateModal_tel-valid-feedback">符合規則</div>
                                    <div class="invalid-feedback" id="updateModal_tel-invalid-feedback">不符合規則</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="" class="form-label">Email</label>
                                    <input type="text" class="form-control is-valid" id="updateModal_email"
                                        name="updateModal_email">
                                    <div class="valid-feedback">符合規則</div>
                                    <div class="invalid-feedback">不符合規則</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="" class="form-label">住址</label>
                                <input type="text" class="form-control is-valid" id="updateModal_addr"
                                    name="updateModal_addr">
                                <div class="valid-feedback">符合規則</div>
                                <div class="invalid-feedback">不符合規則</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="level" class="form-label">會員等級</label>
                                    <select class="form-select" id="updateModal_level" disabled>
                                        <option value="普通會員">普通會員</option>
                                        <option value="VIP會員">VIP會員</option>
                                        <option value="白金會員">白金會員</option>
                                        <option value="管理者">管理者</option>
                                    </select>
                                    <input type="hidden" name="updateModal_level" id="updateModal_level_hidden">
                                </div>

                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="spent" class="form-label">累積消費</label>
                                    <input type="text" class="form-control" id="updateModal_spent"
                                        name="updateModal_spent" disabled>
                                </div>

                            </div>
                        </div>
                    </form>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="text-center">
                                <button type="reset" class="btn btn-secondary">取消</button>
                                <button type="button" class="btn btn-primary" id="member_update_btn">儲存變更</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="order_query" role="tabpanel" aria-labelledby="order_query-tab">
                    <h2 class="text-center mb-3">您的訂單查詢如下:</h2>
                    <div class="my-5">
                        <table class="table text-center table-hover" style="white-space: nowrap;">
                            <thead class="table-dark">
                                <tr>
                                    <th>訂單編號</th>
                                    <th>客戶姓名</th>
                                    <th>行程名稱</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="member_orders_data">
                                <tr class="clickable" data-id="1">
                                    <td>1</td>
                                    <td>user001</td>
                                    <td>王小明</td>
                                    <td>0912-345-678</td>
                                    <td><button class="btn btn-primary toggle-details">查看更多</button></td>
                                </tr>
                                <tr class="details" data-details="1">
                                    <td>
                                        <form id="updateProfileForm">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="id" class="form-label">訂單編號</label>
                                                        <input type="text" class="form-control" id="orders_id"
                                                            name="orders_id" placeholder="不可修改" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="username" class="form-label">客戶姓名</label>
                                                        <input type="text" class="form-control" id="username"
                                                            name="username" placeholder="留空則不變更" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="process_id" class="form-label">行程編號</label>
                                                        <input type="text" class="form-control" id="process_id"
                                                            name="process_id" placeholder="不可變更" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="title" class="form-label">行程名稱</label>
                                                        <input type="text" class="form-control" id="title" name="title"
                                                            placeholder="不可變更" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="mb-3">
                                                        <label for="order_spent" class="form-label">訂購金額</label>
                                                        <input type="text" class="form-control" id="order_spent"
                                                            name="order_spent" placeholder="不可變更" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="mb-3">
                                                        <label for="order_date" class="form-label">訂購日期</label>
                                                        <input type="text" class="form-control" id="order_date"
                                                            name="order_date" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="mb-3">
                                                        <label for="pay_status" class="form-label">付款狀態</label>
                                                        <input type="text" class="form-control" id="pay_status"
                                                            name="pay_status" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="mb-3">
                                                        <label for="adults" class="form-label">大人</label>
                                                        <input type="text" class="form-control" id="adults"
                                                            name="adults" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="mb-3">
                                                        <label for="children" class="form-label">小孩</label>
                                                        <input type="text" class="form-control" id="children"
                                                            name="children" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </section>
    <section id="s11">
        <div class="footer_content" style="background-color: #530c6e;color: #e6d4f3;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-7 col-12 left-area">
                        <div class="mb-sm-5 mb-4 wow animate__animated animate__fadeInUp fadeInUp animate__slow"
                            data-wow-delay="0s" style="visibility: visible; animation-name: fadeInUp;">
                            <h1 class="fw-900 mt-5"> <a href="#"
                                    style="text-decoration: none;color:#e6d4f3">綜彩旅行社有限公司</a></h1>
                        </div>
                        <div class="footer-info wow animate__animated animate__fadeInDown animate__slow"
                            data-wow-delay="0s" style="visibility: visible; animation-name: fadeInDown;">
                            <ul class="list-unstyled">
                                <li>統一編號：27560645</li>
                                <li>交觀甲 第6783號 / 品保 北1513</li>
                                <li>負責人：吳佳筠 / 聯絡人：徐信杰</li>
                            </ul>
                            <ul class="list-unstyled">
                                <li>電話：<a href="tel:0225715838" class="d-inline-block">02-2571-5838</a>、<a
                                        href="tel:0225634633" class="d-inline-block">02-2563-4633</a></li>
                                <li>傳真：02-2562-2269</li>
                                <li>地址：104台北市中山區松江路152號６樓603室</li>
                                <li>信箱：<a href="mailto:colorfultravel@yahoo.com.tw">colorfultravel@yahoo.com.tw</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-12 wow animate__animated animate__slideInUp animate__slow" data-wow-delay="0s"
                        style="visibility: visible; animation-name: slideInUp;">
                        <div class="copyrights-info clearfix mt-4">
                            <div class="copyrights d-inline-block mr-3 mb-2">Copyright © 綜彩旅行社有限公司 All Rights Reserved
                            </div>
                            <div class="copyrights d-inline-block">本網站內容享有著作權，禁止侵害，違者必究。</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="https://unpkg.com/counterup2@2.0.2/dist/index.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/sweetalert2.all.min.js"></script>
    <script src="https://kit.fontawesome.com/176a59b465.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const hash = window.location.hash;
            if (hash) {
                const targetTabBtn = document.querySelector(`button[data-bs-target="${hash}"]`);
                if (targetTabBtn) {
                    const tab = new bootstrap.Tab(targetTabBtn);
                    tab.show();
                }
            }
        });

        var flag_updateModal_email = true;
        var flag_updateModal_tel = true;
        var flag_updateModal_userName = true;
        var flag_updateModal_level = true;
        var flag_updateModal_addr = true;
        var flag_updateModal_uploadPath = true;
        var u_id;
        $(function () {


            // 確認uid是否合法
            if (getCookie("Uid01")) {

                var JSONdata = {};
                JSONdata["uid01"] = getCookie("Uid01");

                $.ajax({
                    type: "POST",
                    url: "20241226-ex1-member_control_api_v1.php?action=checkuid",
                    data: JSON.stringify(JSONdata),
                    dataType: "json",
                    success: showdata_checkuid,
                    error: function () {
                        Swal.fire({
                            title: "API介接錯誤?",
                            text: "20241226-ex1-member_control_api_v1.php",
                            icon: "error"
                        });
                    }
                });
            } else {
                Swal.fire({
                    title: "請先登入會員",
                    icon: "info",
                    showDenyButton: false,
                    showCancelButton: false,
                    confirmButtonText: "確認",
                    denyButtonText: `Don't save`,
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        location.href = "index.html"
                    }
                });
            }

            $("#s02_logout_btn").click(function () {
                setCookie("Uid01", "", 7);
                location.href = "index.html";
            });

            $(document).ready(function () {
                $(document).on("click", ".toggle-details", function () {
                    var rowId = $(this).closest("tr").data("id");
                    $("tr[data-details='" + rowId + "']").fadeToggle();
                });
            });


            function showdata_checkuid(data) {
                console.log(data);
                if (data.state) {
                    $("#s02_username_showtext").removeClass("d-none");
                    $("#s02_username_text").text(data.data.userName);
                    $("#s02_logout_btn").removeClass("d-none");
                    $("#s12").removeClass("d-none");
                    if (data.data.level != "" && data.data.level === "管理者") {

                        $("#s02_manager_panel_btn").removeClass("d-none");
                    } else if (data.data.level != "") {
                        $("#s02_member_panel_btn").removeClass("d-none");
                    }

                    // 若有uid，show個人資料
                    let JSONmemberdata = { id: data.data.id };

                    console.log(JSON.stringify(JSONmemberdata));
                    $.ajax({
                        type: "POST",
                        url: "20241226-ex1-member_control_api_v1.php?action=getmemberdata",
                        data: JSON.stringify(JSONmemberdata),
                        dataType: "json",
                        success: showdata_getmemberdata,
                        error: function () {
                            Swal.fire({
                                title: "API介接錯誤?",
                                text: "20241226-ex1-member_control_api_v1.php",
                                icon: "error"
                            });
                        }
                    });

                    // 若帳號合法，show個人訂單資料
                    let JSONordersdata = { id: data.data.id };
                    $.ajax({
                        type: "POST",
                        url: "20241226-ex1-orders_control_api_v1.php?action=getordersdata",
                        data: JSON.stringify(JSONordersdata),
                        dataType: "json",
                        success: showdata_getordersdata,
                        error: function () {
                            Swal.fire({
                                title: "API介接錯誤?",
                                text: "20241226-ex1-orders_control_api_v1.php",
                                icon: "error"
                            });
                        }
                    });

                    //即時監聽updateModal_uploadPath
                    $("#updateModal_uploadPath").change(function () {
                        if (updateModal_uploadPath.files[0].type == "image/jpeg" || updateModal_uploadPath.files[0].type == "image/png" || updateModal_uploadPath.files[0].type == "image/gif"
                            || updateModal_uploadPath.files[0].type == "image/webp") {
                            console.log(URL.createObjectURL(updateModal_uploadPath.files[0]));
                            $("#profileImg").removeClass("d-none");
                            $("#profileImg").attr("src", URL.createObjectURL(updateModal_uploadPath.files[0]));
                            $("#updateModal_uploadPath").removeClass("is-invalid");
                            $("#updateModal_uploadPath").addClass("is-valid");
                            $("#updateModal_oldphotopath") = $oldphotopath;

                            flag_updateModal_uploadPath = true;
                        } else {
                            $("#updateModal_uploadPath").removeClass("is-valid");
                            $("#updateModal_uploadPath").addClass("is-invalid");
                            $("#profileImg").addClass("d-none");

                            flag_updateModal_uploadPath = false;
                        }
                    });

                    //即時監聽updateModal_username
                    $("#updateModal_username").bind("input propertychange", function () {
                        if ($(this).val().length > 2 && $(this).val().length < 24) {
                            var JSONdata = {};
                            JSONdata["username"] = $("#updateModal_username").val();
                            $.ajax({
                                type: "POST",
                                url: "20241226-ex1-member_control_api_v1.php?action=checkusername",
                                data: JSON.stringify(JSONdata),
                                dataType: "json",
                                success: showdata_member_check_username_reg_uni,
                                error: function () {
                                    Swal.fire({
                                        title: "API介接錯誤",
                                        text: "20241226-ex1-member_control_api_v1.php",
                                        icon: "error"
                                    });
                                }
                            });

                        } else {
                            $(this).removeClass("is-valid");
                            $(this).addClass("is-invalid");
                            $("#updateModal_username-invalid-feedback").text("不符合規則");
                            flag_updateModal_userName = false;
                        }
                    });


                    // 即時監聽updateModal_tel
                    $("#updateModal_tel").bind("input propertychange", function () {
                        if ($(this).val().length != 10) {


                            $("#updateModal_tel").removeClass("is-valid");
                            $("#updateModal_tel").addClass("is-invalid");
                            $("#updateModal_tel-invalid-feedback").text("不符合規則");
                            flag_updateModal_tel = false;
                        } else {

                            var JSONdata = {};
                            JSONdata["updateModal_tel"] = $(this).val();
                            $.ajax({
                                type: "POST",
                                url: "20241226-ex1-member_control_api_v1.php?action=checkupdatetel",
                                data: JSON.stringify(JSONdata),
                                dataType: "json",
                                success: showdata_member_check_tel_reg_uni,
                                error: function () {
                                    Swal.fire({
                                        title: "API介接錯誤",
                                        text: "20241226-ex1-member_control_api_v1.php",
                                        icon: "error"
                                    });
                                }

                            });

                            $("#updateModal_tel").removeClass("is-invalid");
                            $("#updateModal_tel").addClass("is-valid");
                            flag_updateModal_tel = true;
                        }
                    });

                    //即時監聽 updateModal_email
                    $("#updateModal_email").bind("input propertychange", function () {
                        if ($(this).val().length > 2 && $(this).val().length < 48) {
                            $(this).removeClass("is-invalid");
                            $(this).addClass("is-valid");
                            flag_updateModal_email = true;
                        } else {
                            $(this).removeClass("is-valid");
                            $(this).addClass("is-invalid");
                            flag_updateModal_email = false;
                        }
                    });

                    //按紐監聽 member_update_btn
                    $("#member_update_btn").click(function (e) {
                        e.preventDefault(); //禁止表單無效提交
                        if (flag_updateModal_userName && flag_updateModal_tel && flag_updateModal_addr && flag_updateModal_email
                            && flag_updateModal_level && flag_updateModal_uploadPath) {
                            $("#updateModal_level_hidden").val($("#updateModal_level").val());
                            var formData = new FormData($("#updateuser")[0]);
                            $.ajax({
                                type: "POST",
                                url: "20241226-ex1-member_control_api_v1.php?action=updateuser",
                                data: formData,
                                dataType: "json",
                                cache: false,
                                contentType: false,
                                processData: false,
                                success: showdata_updateuser,
                                error: function () {
                                    Swal.fire({
                                        title: "API介接錯誤?",
                                        text: "20241226-ex1-member_control_api_v1.php",
                                        icon: "error"
                                    });
                                }
                            });


                        } else {
                            Swal.fire({
                                title: "欄位有錯誤",
                                icon: "error"
                            });
                        }
                    });

                } else {
                    Swal.fire({
                        title: "請先登入會員!",
                        showDenyButton: false,
                        showCancelButton: false,
                        confirmButtonText: "確認",
                        denyButtonText: `Don't save`,
                        allowOutsideClick: false
                    }).then((result) => {
                        if (result.isConfirmed) {
                            location.href = "index.html";
                        }
                    });
                }
            }

        });

        // 取得memberdata
        function showdata_getmemberdata(data) {
            data.data.forEach(function (item) {
                var oldphotopath = item.uploadPath;
                console.log(oldphotopath);
                $("#updateModal_oldphotopath").val(oldphotopath);
                $("#profileImg").attr("src", oldphotopath ? oldphotopath : "default-avatar.png");
                $("#updateModal_id").val(item.id);
                $("#updateModal_username").val(item.userName);
                $("#updateModal_tel").val(item.tel);
                $("#updateModal_addr").val(item.addr);
                $("#updateModal_email").val(item.email);
                $("#updateModal_level").val(item.level);
                $("#updateModal_spent").val(item.spent);
                $("#updateModal_level_hidden").val($("#updateModal_level").val());
            });
        }

        // 取得ordersdata
        function showdata_getordersdata(data) {
            console.log(data);
            if (data.state) {
                $("#member_orders_data").empty();
                data.data.forEach(function (item) {
                    var strHTML = `
                <tr data-id="${item.id}">
                    <td>${item.id}</td>
                    <td>${item.username}</td>
                    <td>${item.title}</td>
                    <td><button class="btn btn-primary toggle-details">查看更多</button></td>
                </tr>
                <tr class="details" data-details="${item.id}" style="display: none;">
                        <td colspan="12">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">訂單編號</label>
                                        <input type="text" class="form-control" name="orders_id" value="${item.id}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">客戶姓名</label>
                                        <input type="text" class="form-control" name="username" value="${item.username}" disabled>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">行程編號</label>
                                        <input type="text" class="form-control" name="process_id" value="${item.process_id}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">行程名稱</label>
                                        <input type="text" class="form-control" name="title" value="${item.title}" disabled>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">訂購金額</label>
                                        <input type="text" class="form-control" name="order_spent" value="${item.order_spent}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">訂購日期</label>
                                        <input type="date" class="form-control" name="order_date" value="${item.order_date}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label class="form-label">付款狀態</label>
                                        <input type="text" class="form-control" name="pay_status" value="${item.pay_status}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label class="form-label">大人</label>
                                        <input type="text" class="form-control" name="pay_status" value="${item.adults}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label class="form-label">小孩</label>
                                        <input type="text" class="form-control" name="pay_status" value="${item.children}" disabled>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>`;


                    $("#member_orders_data").append(strHTML);
                });
            } else {
                $("#member_orders_data").empty();
                $("#member_orders_data").append(
                    `<div class="text-center text-danger fs-3 w-100">
                        ${data.message}
                    </div>`);
            }


        }

        // 檢查會員帳號是否重複
        function showdata_member_check_username_reg_uni(data) {
            if (data.state) {
                $("#updateModal_username").removeClass("is-invalid");
                $("#updateModal_username").addClass("is-valid");
                flag_updateModal_userName = true;
                $("#updateModal_username-valid-feedback").text(data.message);
            } else {
                $("#updateModal_username").removeClass("is-valid");
                $("#updateModal_username").addClass("is-invalid");
                $("#updateModal_username-invalid-feedback").text(data.message);
                flag_updateModal_userName = false;
            }
        }

        // 檢查會員電話是否重複
        function showdata_member_check_tel_reg_uni(data) {
            if (data.state) {
                $("#updateModal_tel").removeClass("is-invalid");
                $("#updateModal_tel").addClass("is-valid");
                $("#updateModal_tel-valid-feedback").text(data.message);
                flag_updateModal_tel = true;
            } else {
                $("#updateModal_tel").removeClass("is-valid");
                $("#updateModal_tel").addClass("is-invalid");
                $("#updateModal_tel-invalid-feedback").text(data.message);
                flag_updateModal_tel = false;
            }
        }



        // 更新會員資料
        function showdata_updateuser(data) {
            if (data.state) {
                Swal.fire({
                    title: data.message,
                    showDenyButton: false,
                    showCancelButton: false,
                    confirmButtonText: "確認",
                    denyButtonText: `Don't save`,
                    icon: "success",
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        location.href = "20241226-ex1-member_edit_panel_v1.html#account";
                    }
                });
            } else {
                Swal.fire({
                    title: data.message,
                    icon: "error"
                });
            }
        }

        // from w3s Cookie
        function setCookie(cname, cvalue, exdays) {
            const d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            let expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
            let name = cname + "=";
            let ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

    </script>


</body>

</html>